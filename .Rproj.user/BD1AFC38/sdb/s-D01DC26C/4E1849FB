{
    "contents" : "\nlibrary(maps)\nlibrary(mapdata)\nlibrary(lubridate)\n\nsetwd(\"C:/research/phd/analyses/foraging_strategy\")\n\ngps_2015<-read.csv(\"C:/research/phd/fieldwork/LHI_Feb_2015/data/tracking_results/compiled_tracking_data.csv\",\n                   h=T, strip.white=T)\n\ngps_2014<-read.csv(\"C:/research/phd/fieldwork/LHI_Mar_2014/data/tracking_results/compiled_tracking_data.csv\",\n                   h=T, strip.white=T)\n\ngps_dat<-rbind(gps_2014, gps_2015)\n\nhead(gps_dat)\n \ngps_dat$DateTime<-as.POSIXlt(paste(gps_dat$Date, gps_dat$Time), format = \"%Y/%m/%d %H:%M:%S\")\ngps_dat$TrackTime <- as.double(gps_dat$DateTime)\n\ngps_dat$day<-day(gps_dat$DateTime)\ngps_dat$month<-month(gps_dat$DateTime)\ngps_dat$year<-year(gps_dat$DateTime)\n\nplot(Latitude~Longitude, gps_dat, pch=16, cex=0.5, col=factor(year))\nmap(\"worldHires\", add=T,  col=3)\n\nplot(Latitude~Longitude, gps_dat, pch=16, cex=0.5, col=factor(Type))\nmap(\"worldHires\", add=T,  col=3)\n\n#speed filter and resample\n\nsource(\"D:/research/seabird_analyses/Heron_Island/heron_analyses_r_GPS/Velocity_Functions.r\")\n\ndatout <- NULL\nfor(i in unique(gps_dat$TrackID))\n{\n  Temp <-  gps_dat[gps_dat$TrackID == i,]\n  plot(Latitude~Longitude, data=Temp, asp=1, cex=0.5, col=4, main=Temp$TrackID[1])\n  \n  Temp$Vel <- 0\n  for(j in 1:nrow(Temp))\n  {\n    Temp[j,]$Vel <- backforVel(point=j, trip=Temp, n=4, alt=FALSE, filter=FALSE)\n  \n  }\n  points(Latitude~Longitude, data=Temp[Temp$Vel > 75,], asp=1, cex=0.5, col=2)\n  datout <- rbind(datout, Temp)\n  #readline(\"OK\")\n}\n\n###@@@ removing points going with speeds over 75 km/h @@@###\n#datout<-datout[datout$Vel<75,]\n#datout<-na.omit(datout)\n\n#NOT removing high speeds, max vel= 97 km/h. Could be realistic, had 35 knot winds smashing the area for the duration of biologging\n\n####@@@@ RESAMPLE @@@@####\n\n  source(\"D:/research/seabird_analyses/Heron_Island/heron_analyses_r_GPS/Resample.r\")\n  \n  trackz<-unique(datout$TrackID)\n  \n  resamp<-NULL\n  for(k in trackz)\n  {\n  Track<-datout[datout$TrackID ==k,]\n  \n  resample_output<-resample(Track, timeStep=(0.1666667))  ## timeStep set for 10 min intervals\n  \n  resample_output$Date <- format(as.Date(as.POSIXlt(resample_output$TrackTime, origin=\"1970-01-01\")), format=\"%Y/%m/%d\")\n  resample_output$Time <- format((as.POSIXlt(resample_output$TrackTime, origin=\"1970-01-01\")), \"%H:%M:%S\")\n  \n  resamp<-rbind(resamp, resample_output)\n  }\n\ndatout<-resamp\n\nplot(Latitude~Longitude, datout, pch=16, cex=0.4, col=factor(TrackID))\nmap(\"worldHires\", add=T, col=3)\n\nrequire(geosphere)\nrequire(sp)\nrequire(rgdal)\nrequire(rgeos)\nrequire(maptools)\n\n##Tripsplit\n\nsignal_point<-data.frame(Latitude=-31.524732, Longitude=159.059787)\n\n\n#### Trip split ####\nsource(\"D:/research/seabird_analyses/Complete March/TripSplit.r\")\n\nbirds <-unique(datout$TrackID)\ndatout$ID<-datout$TrackID\n\n\nfor(i in birds)\n{\n  Temp <- datout[datout$TrackID==i,]\n  \n  Trip <- tripSplit(Track=Temp, Colony=signal_point, InnerBuff=1, ReturnBuff=5, Duration=0.5, plotit=T)\n  \n  if(which(birds==i) == 1) {Trips <- Trip} else\n    Trips <- spRbind(Trips,Trip)\n  \n  readline(\"\")\n}\n\nwrite.csv(Trips@data, \"LHI_14_15_gps_interp_tripsplit.csv\", quote=F, row.names=F)\n\nplot(Trips)\nplot(Trips[Trips$trip_id==-1,], col=2, add=T)\n\nlibrary(ggplot2)\n\nTrips@data$trip_id_seq<-substr(Trips@data$trip_id, nchar(Trips@data$trip_id),\n                               nchar(Trips@data$trip_id))\n\n\nregion<-map_data(\"world\")\n\n#to appease ggplot\nnames(region)[names(region)==\"long\"]<-\"Longitude\"\nnames(region)[names(region)==\"lat\"]<-\"Latitude\"\n\n\n\nggplot(Trips@data, aes(y=Latitude, x=Longitude, colour=trip_id_seq))+geom_point()+\n  geom_polygon(data=region, aes(group=group))+facet_wrap(~TrackID, scale=\"free\")\n\np<-ggplot(Trips@data, aes(y=Latitude, x=Longitude))+\n  geom_point(aes(colour=trip_id_seq))+geom_polygon(data=region, aes(group=group))+\n  coord_cartesian(xlim=c(152, 162), ylim=c(-35.5, -20))+\n  facet_wrap(~TrackID)\n\np\n\nggsave(filename=\"LHI_gps_trips1.png\", scale=2)\n\ngraphics.off()\n\np2<-ggplot(Trips@data, aes(y=Latitude, x=Longitude))+\n  geom_point(aes(colour=trip_id_seq))+\n  facet_wrap(~TrackID, scale=\"free\")\n\np2\n\nggsave(filename=\"LHI_gps_trips2.png\", scale=2)\n\ngraphics.off()\n\ntrip_lens<-NULL\nfor(j in unique(Trips$trip_id))\n{\n  trippy<-Trips[Trips$trip_id==j,]\n  diff<-((trippy[nrow(trippy),]$TrackTime-trippy[1,]$TrackTime)/3600)/24\n  out<-data.frame(trip_id=j, trip_len=diff, st_dt=trippy[1,]$DateTime, \n                  nd_dt=trippy[nrow(trippy),]$DateTime, st_dist=trippy[1,]$Distance, \n                  nd_dist=trippy[nrow(trippy),]$Distance, return=unique(trippy$Returns))\n  trip_lens<-rbind(trip_lens, out)\n}\n\nwrite.csv(trip_lens, \"trip_lengths_from_gps.csv\", quote=F, row.names=F)\n\nt_len_corr<-read.csv(\"trip_lengths_from_gps.csv\", h=T)\n\nt_len_corr$DateTime<-as.POSIXlt(t_len_corr$st_dt, format = \"%d/%m/%Y %H:%M\")\nt_len_corr$st_tt <- as.double(t_len_corr$DateTime)\n\n\nt_len_corr$DateTime_nd<-as.POSIXlt(t_len_corr$Actual_return, format = \"%d/%m/%Y %H:%M\")\nt_len_corr$nd_tt <- as.double(t_len_corr$DateTime_nd)\n\nt_len_corr$trip_len2<-((t_len_corr$nd_tt-t_len_corr$st_tt)/3600)/24\n\nt_len_corr[which(is.na(t_len_corr$trip_len2)),]$trip_len2<-\n  t_len_corr[which(is.na(t_len_corr$trip_len2)),]$trip_len\n\nqplot(data=t_len_corr, x=trip_len2, geom=\"histogram\")\n\n\n\n",
    "created" : 1438918798041.000,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4029541841",
    "id" : "4E1849FB",
    "path" : "~/GitHub/WTSH_foraging_strategy/foraging_strategy_LHI_tracking.R",
    "project_path" : "foraging_strategy_LHI_tracking.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}
